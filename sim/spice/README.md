# Running SPICE simulations

Here are some high-level tips about running this:

*   Tested with the IHP-Open-PDK (SG13G2) on ngspice "44+" (upcoming new version 45).
*   `.spiceinit` is the one supplied by the PDK.
*   `$PDK_ROOT` and `$PDK` must be set.
*   `sim_r2r_dac.cir` is a simple (and fast) simulation of just the basic R2R DAC layout.
    *   It instantiates a SPICE model PEX (Parasitic EXtraction) of the `../../magic/r2r_dac.mag` layout, generated by doing: `cd ../../magic && make r2r_dac.sim.spice`
    *   NOTE: Instantiation of the model `r2r_dac_parax` is done as a device called "`XDUT`" and its pin order must match that of the PEX SPICE file.
    *   To run this simulation, run: `ngspice sim_r2r_dac.cir` -- it should produce a plot that compares the digital input signal (blue line; an 8-bit ramp, in the virtual range 0-1.2V) with the actual circuit output value (red line). NOTE: This output is pulled quite low (0~0.24V) by the simulated 2.2k pull-down, intended for virtually lowering the output impedance in order to achieve faster slew.
*   `sim_buffer_r2r.cir` is the same as `sim_r2r_dac.cir` but with an extra R2R DAC wired to the PEX of `rgb_buffers` (driven by a 10k-impedance version of the digital input signal) to compare how the output signal looks when driven by `sg13g2_buf_8` buffer cells.
*   Raw data is written to `sim_out/*.raw`
*   CTRL+C will interrupt a simulation, at which point you can:
    *   Do a `write` (with the vector parameters you want to write, as arguments)
    *   Save a snapshot of the simulation, e.g. `snsave blahblah.snap` -- allowing for resuming later.
    *   Do a `plot`
    *   `continue`
*   `plot` can include `xlimit 0 800ns` (for example)
